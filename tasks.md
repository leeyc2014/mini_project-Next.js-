# 구현 계획: 반려동물 시설 지도

## 개요

Next.js 14 App Router와 TypeScript를 사용하여 반려동물 시설 지도 애플리케이션을 구현합니다. MySQL 데이터베이스를 사용하여 시설 데이터를 저장하고, Prisma ORM으로 데이터를 관리합니다.

## 작업 목록

- [ ] 1. 프로젝트 초기 설정 및 데이터베이스 구성
  - Next.js 14 프로젝트 생성 (App Router 사용)
  - TypeScript, Tailwind CSS 설정
  - Prisma 설치 및 MySQL 연결 설정
  - 환경 변수 파일 (.env) 생성
  - _요구사항: 1.4, 6.1_

- [ ] 2. 데이터베이스 스키마 생성
  - [ ] 2.1 Prisma 스키마 파일 작성
    - Province, District, Category, Facility 모델 정의
    - 외래 키 관계 설정
    - 인덱스 및 FULLTEXT 인덱스 설정
    - _요구사항: 1.4_
  
  - [ ] 2.2 데이터베이스 마이그레이션 실행
    - `prisma migrate dev` 명령으로 테이블 생성
    - 마이그레이션 파일 생성 및 적용
    - _요구사항: 1.4_

- [ ] 3. CSV 파싱 및 데이터 임포트 스크립트 구현
  - [ ] 3.1 CSV 파서 유틸리티 작성
    - CSV 파일 읽기 및 파싱 함수 구현
    - 필수 필드 유효성 검증 로직 구현
    - 잘못된 행 건너뛰기 및 로깅
    - _요구사항: 1.1, 1.2, 1.3_
  
  - [ ]* 3.2 CSV 파서 속성 테스트 작성
    - **속성 1: 유효한 CSV 행 파싱**
    - **속성 2: 필수 필드 검증**
    - **속성 3: 잘못된 행 건너뛰기**
    - **검증: 요구사항 1.1, 1.2, 1.3**
  
  - [ ] 3.3 데이터 임포트 스크립트 작성
    - Province, District, Category 데이터 추출 및 삽입
    - Facility 데이터 삽입 (외래 키 참조)
    - 중복 데이터 처리 (upsert 사용)
    - 진행률 표시 및 오류 처리
    - _요구사항: 1.4, 1.5_
  
  - [ ]* 3.4 데이터 임포트 속성 테스트 작성
    - **속성 4: 데이터베이스 저장 라운드 트립**
    - **속성 5: 중복 데이터 처리**
    - **검증: 요구사항 1.4, 1.5**

- [ ] 4. 체크포인트 - 데이터 임포트 확인
  - CSV 파일을 사용하여 데이터 임포트 실행
  - 데이터베이스에 데이터가 올바르게 저장되었는지 확인
  - 모든 테스트가 통과하는지 확인
  - 문제가 있으면 사용자에게 질문

- [ ] 5. API Routes 구현 - 시설 조회
  - [ ] 5.1 Data Service 클래스 구현
    - Prisma Client를 사용한 데이터베이스 쿼리 함수
    - 필터링 로직 (지역, 카테고리, 검색어)
    - 페이지네이션 로직
    - 위치 기반 검색 로직 (Haversine 공식)
    - _요구사항: 6.2, 6.3, 6.4, 6.5, 6.6_
  
  - [ ]* 5.2 Data Service 속성 테스트 작성
    - **속성 15: API 필터링 정확성**
    - **속성 16: API 위치 기반 검색 정확성**
    - **속성 17: API 페이지네이션 정확성**
    - **검증: 요구사항 6.2, 6.3, 6.4, 6.5, 6.6**
  
  - [ ] 5.3 GET /api/facilities 엔드포인트 구현
    - 쿼리 파라미터 파싱 (province, district, categories, search, limit, offset, lat, lng, radius)
    - Data Service 호출 및 응답 반환
    - 오류 처리 및 적절한 HTTP 상태 코드 반환
    - _요구사항: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7_
  
  - [ ] 5.4 GET /api/facilities/[id] 엔드포인트 구현
    - 경로 파라미터에서 ID 추출
    - 시설 상세 정보 조회 및 반환
    - 시설이 없을 경우 404 반환
    - _요구사항: 6.8_
  
  - [ ]* 5.5 API 엔드포인트 속성 테스트 작성
    - **속성 18: API 오류 처리**
    - **속성 19: API 시설 상세 조회**
    - **검증: 요구사항 6.7, 6.8**

- [ ] 6. API Routes 구현 - 필터 옵션
  - [ ] 6.1 GET /api/filters 엔드포인트 구현
    - Province, District, Category 목록 조회
    - 필터 옵션 객체 반환
    - _요구사항: 6.9_
  
  - [ ] 6.2 GET /api/categories 엔드포인트 구현
    - 모든 카테고리 목록 조회 및 반환
    - _요구사항: 4.1_
  
  - [ ] 6.3 GET /api/regions 엔드포인트 구현
    - 쿼리 파라미터에 따라 시/도 또는 시/군/구 목록 반환
    - _요구사항: 3.1, 3.2_

- [ ] 7. 체크포인트 - API 테스트
  - 모든 API 엔드포인트가 올바르게 작동하는지 확인
  - Postman 또는 curl로 API 테스트
  - 모든 테스트가 통과하는지 확인
  - 문제가 있으면 사용자에게 질문

- [ ] 8. 프론트엔드 - 지도 컴포넌트 구현
  - [ ] 8.1 Kakao Maps SDK 설정
    - 환경 변수에 Kakao API 키 추가
    - Script 태그로 Kakao Maps SDK 로드
    - _요구사항: 2.1_
  
  - [ ] 8.2 MapComponent 구현
    - 지도 초기화 및 렌더링
    - 시설 마커 표시 (마커 클러스터링 적용)
    - 마커 클릭 시 상세 정보 팝업 표시
    - 지도 중심 및 줌 레벨 조정
    - _요구사항: 2.1, 2.2, 2.3, 2.4, 3.3, 8.1_
  
  - [ ]* 8.3 MapComponent 속성 테스트 작성
    - **속성 6: 마커 수 일치**
    - **속성 7: 마커 클릭 시 상세 정보 표시**
    - **속성 21: 마커 클러스터링 활성화**
    - **검증: 요구사항 2.2, 2.3, 8.1**

- [ ] 9. 프론트엔드 - 필터 컴포넌트 구현
  - [ ] 9.1 FilterPanel 컴포넌트 구현
    - 시/도 선택 드롭다운
    - 시/군/구 선택 드롭다운 (시/도 선택 시 활성화)
    - 카테고리 다중 선택 체크박스
    - 필터 초기화 버튼
    - 필터 변경 시 콜백 호출
    - _요구사항: 3.1, 3.2, 3.4, 4.1, 4.2, 4.3_
  
  - [ ]* 9.2 FilterPanel 속성 테스트 작성
    - **속성 8: 지역 필터링 정확성**
    - **속성 9: 필터 초기화**
    - **속성 10: 카테고리 필터링 정확성**
    - **속성 11: 필터 변경 시 마커 업데이트**
    - **검증: 요구사항 3.1, 3.2, 3.4, 4.2, 4.3, 4.4**

- [ ] 10. 프론트엔드 - 검색 컴포넌트 구현
  - [ ] 10.1 SearchBar 컴포넌트 구현
    - 검색어 입력 필드
    - 디바운싱 적용 (300ms)
    - 검색 콜백 호출
    - _요구사항: 5.1_
  
  - [ ]* 10.2 SearchBar 속성 테스트 작성
    - **속성 12: 검색 결과 정확성**
    - **속성 13: 검색 결과 표시 일치**
    - **속성 14: 검색 결과 클릭 시 지도 이동**
    - **검증: 요구사항 5.1, 5.2, 5.3**

- [ ] 11. 프론트엔드 - 시설 상세 모달 구현
  - [ ] 11.1 FacilityDetailModal 컴포넌트 구현
    - 시설 전체 정보 표시
    - 전화 걸기, 홈페이지 링크
    - 길찾기 버튼 (Kakao Map 앱 연동)
    - 모달 닫기 기능
    - _요구사항: 2.3_

- [ ] 12. 프론트엔드 - 메인 페이지 통합
  - [ ] 12.1 MainPage 컴포넌트 구현
    - API에서 시설 데이터 로드
    - 필터 상태 관리 (useState)
    - 검색 상태 관리
    - 로딩 및 에러 상태 처리
    - 모든 하위 컴포넌트 통합
    - _요구사항: 2.1, 3.1, 4.1, 5.1, 8.4_
  
  - [ ]* 12.2 MainPage 속성 테스트 작성
    - **속성 22: API 요청 중 로딩 상태**
    - **검증: 요구사항 8.4**

- [ ] 13. 반응형 UI 구현
  - [ ] 13.1 모바일 레이아웃 구현
    - Tailwind CSS 반응형 클래스 적용
    - 모바일에서 필터 드로어/모달 구현
    - 터치 제스처 지원 확인
    - _요구사항: 7.1, 7.2, 7.3_
  
  - [ ]* 13.2 반응형 UI 속성 테스트 작성
    - **속성 20: 화면 크기 변경 시 레이아웃 조정**
    - **검증: 요구사항 7.2**

- [ ] 14. 최종 체크포인트 - 통합 테스트
  - 전체 애플리케이션 플로우 테스트
  - 모든 기능이 올바르게 작동하는지 확인
  - 모든 속성 테스트가 통과하는지 확인
  - 성능 확인 (로딩 시간, 필터링 속도)
  - 문제가 있으면 사용자에게 질문

- [ ] 15. 문서화 및 배포 준비
  - README.md 작성 (설치 방법, 실행 방법, 환경 변수 설정)
  - API 문서 작성
  - 데이터베이스 설정 가이드 작성
  - CSV 임포트 가이드 작성

## 참고사항

- `*` 표시가 있는 작업은 선택 사항입니다 (빠른 MVP를 위해 건너뛸 수 있음)
- 각 작업은 이전 작업을 기반으로 하므로 순서대로 진행해야 합니다
- 체크포인트에서는 모든 테스트가 통과하는지 확인하고 문제가 있으면 수정합니다
- 속성 기반 테스트는 fast-check 라이브러리를 사용하여 최소 100회 반복 실행합니다
